# Node Boilerplate

A Nodejs boilerplate using [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html). Please read that article first if you not familiar with it.

## Set up

- Clone this repo
- Copy paste `.env.sample` to `.env`. Set the env. Read the details about key value pair on the **Configuration** section below
- Run `npm run setup`. This command will setup everthing you need. Including install dependencies, migrating database and seeding the database.
- Run `npm run dev` for development. This will run using [nodemon](https://nodemon.io) for hot reload.
- Run `npm start` for production.

## Configuration

| Key       | Value                                      | Description                                     |
| --------- | ------------------------------------------ | ----------------------------------------------- |
| NODE_ENV  | `development`, `testing`, or `production`  | environment                                     |
| NODE_PATH | .                                          | project path                                    |
| PORT      | `<number>`                                 | app port, any number                            |
| DB_HOST   | `localhost`                                | database host                                   |
| DB_PORT   | `<number>`                                 | database port                                   |
| DB_PASS   | `<string>`                                 | database password                               |
| DB_NAME   | `<string>`                                 | database name                                   |
| LOGGING   | `"console"`, `"file"`, or `"console file"` | logging output, separate each value using space |

## Dependencies

See in `package.json` at `dependencies` section.

## Run tests and coverage

- Unit test : run `npm test`
- Unit test with code coverage : run `npm run coverage`
  **Note: Please complete the Unit Test based on my example. I dont have enough time to do that.**

## Explanation

### Folder Structure

Im adapting this folder structure based on [this repo](https://github.com/talyssonoc/node-api-boilerplate/wiki/Folder-structure). Of course Im little bit adjusting the other stuff, because the original structure containing old version of dependencies.

```
.
├── index.js                        //entry point
├── logs                            //for saving log file if your LOGGING env var is file
│   └── server.log                  //auto generated by library
├── package-lock.json
├── package.json
├── src                             //all layer goes here
│   ├── application                 //containing logic proses for application
│   │   └── usecase                 //all logic process here
│   │       ├── AddMovie.js
│   │       ├── DeleteMovie.js
│   │       ├── GetMovieById.js
│   │       ├── ListMovies.js
│   │       └── UpdateMovie.js
│   ├── container.js                //connecting all dependency here (dependency injection)
│   ├── domain                      //containing the entity classes of the app
│   │   └── Movie.js
│   ├── infrastructure              //all third party here, you can change the library or the database. As long as you don't break the dependency injection
│   │   ├── database                //here we use sequelize ORM for SQL database
│   │   │   └── sequelize
│   │   │       ├── migrations
│   │   │       │   └── 20210220142755-add_movies_table.js
│   │   │       ├── models
│   │   │       │   └── movie.js
│   │   │       ├── seeders
│   │   │       │   └── 20210221055725-movies.js
│   │   │       └── sequelize.js
│   │   ├── logging                 //for logging request or error
│   │   │   ├── LoggerStreamAdapter.js
│   │   │   └── index.js
│   │   ├── repositories            //all database interaction happen here
│   │   │   └── MovieRepositoryPostgres.js
│   │   ├── response                //base response builder
│   │   │   └── index.js
│   │   └── server                  //app server
│   │       └── index.js
│   └── interfaces                  //containing routes, route handler, and data serializers
│       ├── controllers             //route handler
│       │   └── MovieController.js
│       ├── routes                  //routes
│       │   └── index.js
│       └── serializers             //data serializer
│           └── MovieSerializer.js
└── test                            //unit tests goes here
    └── application
        └── usecase
            └── TestAddMovie.js
```

### Dependency Injection

Basically dependency injection same as [interface in Java](https://www.w3schools.com/java/java_interface.asp) or [in golang](https://tour.golang.org/methods/9). In OOP Interface we must implement all of our method in interface. Based on this rule, we can easily swap our database or other library.
Because Javascript dont have Interface, we use [awilix](https://github.com/jeffijoe/awilix) to handle those Interface job.

### Database, Migration and Seeding

In this example I use Postgres as database. So, make sure you install Postgres first.
Regarding to migration and seeding. You need to read [sequelize docs](https://sequelize.org/master/manual/migrations.html). Please read sequelize docs if you still use sequelize and want to use it's feature. **But, remember you need to use this args if you want to use your database as you set in `.env`** : `--url $(npm run dbUrl --silent)`.
Example:
`npx sequelize-cli db:migrate --url $(npm run dbUrl --silent)`

### Json Style

I used [google style](https://google.github.io/styleguide/jsoncstyleguide.xml) in this architecture. Please read it first.

## References

- <https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html>
- <https://github.com/talyssonoc/node-api-boilerplate/wiki>
